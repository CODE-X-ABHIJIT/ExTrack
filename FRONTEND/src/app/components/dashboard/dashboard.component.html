<div
  class="container-fluid px-4 py-4"
  style="
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
  "
>
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div
        class="card border-0 shadow-lg"
        style="
          background: rgba(255, 255, 255, 0.95);
          backdrop-filter: blur(10px);
        "
      >
        <div class="card-body p-4">
          <div
            class="d-flex justify-content-between align-items-center flex-wrap gap-3"
          >
            <div>
              <h1 class="display-5 fw-bold mb-2 text-primary">
                <i class="bi bi-graph-up-arrow"></i> Financial Dashboard
              </h1>
              <p class="text-muted mb-0 fs-6">
                Welcome back, {{ getUsername() }}! Track your finances in
                real-time
              </p>
            </div>
            <button
              class="btn btn-primary btn-lg px-4 shadow"
              (click)="refreshData()"
              [disabled]="loading"
            >
              <span
                *ngIf="loading"
                class="spinner-border spinner-border-sm me-2"
              ></span>
              <i *ngIf="!loading" class="bi bi-arrow-clockwise"></i>
              <span class="ms-2">{{ loading ? "Loading..." : "Refresh" }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="row">
    <div class="col-12">
      <div
        class="card border-0 shadow-lg text-center py-5"
        style="background: rgba(255, 255, 255, 0.95)"
      >
        <div class="card-body">
          <div
            class="spinner-border text-primary mb-3"
            style="width: 4rem; height: 4rem"
            role="status"
          >
            <span class="visually-hidden">Loading...</span>
          </div>
          <h4 class="text-primary">Loading your financial data...</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error && !loading" class="row mb-4">
    <div class="col-12">
      <div
        class="alert alert-danger alert-dismissible fade show shadow-lg border-0 d-flex align-items-center"
        role="alert"
      >
        <i class="bi bi-exclamation-triangle-fill fs-3 me-3"></i>
        <div class="flex-grow-1">
          <h5 class="alert-heading mb-1">Error Occurred!</h5>
          <p class="mb-0">{{ error }}</p>
        </div>
        <button
          type="button"
          class="btn-close"
          (click)="error = null"
          aria-label="Close"
        ></button>
      </div>
    </div>
  </div>

  <!-- Main Content - Only show when data is loaded -->
  <div *ngIf="!loading">
    <!-- Main Stats Cards -->
    <div class="row g-4 mb-4" *ngIf="stats">
      <!-- Total Income -->
      <div class="col-lg-4 col-md-6">
        <div
          class="card border-0 shadow-lg h-100 text-white"
          style="background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%)"
        >
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="bg-white bg-opacity-25 p-3 rounded-3">
                <i class="bi bi-arrow-down-circle-fill fs-1"></i>
              </div>
              <div class="text-end flex-grow-1 ms-3">
                <p class="mb-1 text-white-50 text-uppercase fw-semibold small">
                  Total Income
                </p>
                <h2 class="display-5 fw-bold mb-0">
                  ₹{{ stats.income || 0 | number : "1.0-0" }}
                </h2>
                <small class="text-white-50">{{
                  stats.income || 0 | number : "1.2-2"
                }}</small>
              </div>
            </div>
            <div class="border-top border-white border-opacity-25 pt-3">
              <small class="text-white-50">Latest: </small>
              <strong class="text-white">{{
                stats.latestIncome?.title || "No income yet"
              }}</strong>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Expense -->
      <div class="col-lg-4 col-md-6">
        <div
          class="card border-0 shadow-lg h-100 text-white"
          style="background: linear-gradient(135deg, #dc2626 0%, #f87171 100%)"
        >
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="bg-white bg-opacity-25 p-3 rounded-3">
                <i class="bi bi-arrow-up-circle-fill fs-1"></i>
              </div>
              <div class="text-end flex-grow-1 ms-3">
                <p class="mb-1 text-white-50 text-uppercase fw-semibold small">
                  Total Expense
                </p>
                <h2 class="display-5 fw-bold mb-0">
                  ₹{{ stats.expense || 0 | number : "1.0-0" }}
                </h2>
                <small class="text-white-50">{{
                  stats.expense || 0 | number : "1.2-2"
                }}</small>
              </div>
            </div>
            <div class="border-top border-white border-opacity-25 pt-3">
              <small class="text-white-50">Latest: </small>
              <strong class="text-white">{{
                stats.latestExpense?.title || "No expense yet"
              }}</strong>
            </div>
          </div>
        </div>
      </div>

      <!-- Balance -->
      <div class="col-lg-4 col-md-12">
        <div
          class="card border-0 shadow-lg h-100 text-white"
          [style.background]="
            (stats.balance || 0) >= 0
              ? 'linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)'
              : 'linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)'
          "
        >
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="bg-white bg-opacity-25 p-3 rounded-3">
                <i class="bi bi-wallet2 fs-1"></i>
              </div>
              <div class="text-end flex-grow-1 ms-3">
                <p class="mb-1 text-white-50 text-uppercase fw-semibold small">
                  Current Balance
                </p>
                <h2 class="display-5 fw-bold mb-0">
                  ₹{{ stats.balance || 0 | number : "1.0-0" }}
                </h2>
                <small class="text-white-50">{{
                  stats.balance || 0 | number : "1.2-2"
                }}</small>
              </div>
            </div>
            <div class="border-top border-white border-opacity-25 pt-3">
              <span
                class="badge px-3 py-2"
                [ngClass]="
                  (stats.balance || 0) >= 0 ? 'bg-success' : 'bg-warning'
                "
              >
                <i
                  class="bi"
                  [ngClass]="
                    (stats.balance || 0) >= 0 ? 'bi-arrow-up' : 'bi-arrow-down'
                  "
                ></i>
                {{ (stats.balance || 0) >= 0 ? "Surplus" : "Deficit" }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Min/Max Stats -->
    <div class="row g-3 mb-4" *ngIf="stats">
      <div class="col-lg-3 col-md-6">
        <div
          class="card border-0 shadow h-100"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-body text-center p-4">
            <div
              class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
              style="width: 60px; height: 60px"
            >
              <i class="bi bi-arrow-down fs-3 text-success"></i>
            </div>
            <p class="text-muted text-uppercase small fw-semibold mb-2">
              Min Income
            </p>
            <h3 class="text-success fw-bold mb-0">
              ₹{{ stats.minIncome || 0 | number : "1.2-2" }}
            </h3>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6">
        <div
          class="card border-0 shadow h-100"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-body text-center p-4">
            <div
              class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
              style="width: 60px; height: 60px"
            >
              <i class="bi bi-arrow-up fs-3 text-success"></i>
            </div>
            <p class="text-muted text-uppercase small fw-semibold mb-2">
              Max Income
            </p>
            <h3 class="text-success fw-bold mb-0">
              ₹{{ stats.maxIncome || 0 | number : "1.2-2" }}
            </h3>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6">
        <div
          class="card border-0 shadow h-100"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-body text-center p-4">
            <div
              class="bg-danger bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
              style="width: 60px; height: 60px"
            >
              <i class="bi bi-arrow-down fs-3 text-danger"></i>
            </div>
            <p class="text-muted text-uppercase small fw-semibold mb-2">
              Min Expense
            </p>
            <h3 class="text-danger fw-bold mb-0">
              ₹{{ stats.minExpense || 0 | number : "1.2-2" }}
            </h3>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6">
        <div
          class="card border-0 shadow h-100"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-body text-center p-4">
            <div
              class="bg-danger bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
              style="width: 60px; height: 60px"
            >
              <i class="bi bi-arrow-up fs-3 text-danger"></i>
            </div>
            <p class="text-muted text-uppercase small fw-semibold mb-2">
              Max Expense
            </p>
            <h3 class="text-danger fw-bold mb-0">
              ₹{{ stats.maxExpense || 0 | number : "1.2-2" }}
            </h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Latest Transactions -->
    <div
      class="row g-4 mb-4"
      *ngIf="stats && (stats.latestIncome || stats.latestExpense)"
    >
      <!-- Latest Income -->
      <div class="col-md-6" *ngIf="stats.latestIncome">
        <div
          class="card border-0 shadow-lg h-100"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-header bg-success text-white border-0 py-3">
            <h5 class="mb-0 d-flex align-items-center">
              <i class="bi bi-arrow-down-circle-fill fs-4 me-2"></i>
              Latest Income Transaction
            </h5>
          </div>
          <div class="card-body p-4">
            <h4 class="card-title fw-bold mb-4">
              {{ stats.latestIncome.title }}
            </h4>
            <div class="row g-3">
              <div class="col-6">
                <div class="border-start border-success border-4 ps-3">
                  <p class="text-muted mb-1 small">Amount</p>
                  <h3 class="text-success fw-bold mb-0">
                    ₹{{ stats.latestIncome.amount | number : "1.2-2" }}
                  </h3>
                </div>
              </div>
              <div class="col-6">
                <div class="border-start border-secondary border-4 ps-3">
                  <p class="text-muted mb-1 small">Date</p>
                  <h6 class="mb-0 fw-semibold">
                    {{ stats.latestIncome.date | date : "dd MMM yyyy" }}
                  </h6>
                </div>
              </div>
              <div class="col-12">
                <div class="d-flex align-items-center gap-2 mb-2">
                  <span class="text-muted small">Category:</span>
                  <span class="badge bg-success px-3 py-2">
                    <i class="bi bi-tag-fill me-1"></i
                    >{{ stats.latestIncome.category }}
                  </span>
                </div>
                <div
                  class="bg-light rounded p-3"
                  *ngIf="stats.latestIncome.description"
                >
                  <small class="text-muted d-block mb-1">Description:</small>
                  <p class="mb-0">{{ stats.latestIncome.description }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Latest Expense -->
      <div class="col-md-6" *ngIf="stats.latestExpense">
        <div
          class="card border-0 shadow-lg h-100"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-header bg-danger text-white border-0 py-3">
            <h5 class="mb-0 d-flex align-items-center">
              <i class="bi bi-arrow-up-circle-fill fs-4 me-2"></i>
              Latest Expense Transaction
            </h5>
          </div>
          <div class="card-body p-4">
            <h4 class="card-title fw-bold mb-4">
              {{ stats.latestExpense.title }}
            </h4>
            <div class="row g-3">
              <div class="col-6">
                <div class="border-start border-danger border-4 ps-3">
                  <p class="text-muted mb-1 small">Amount</p>
                  <h3 class="text-danger fw-bold mb-0">
                    ₹{{ stats.latestExpense.amount | number : "1.2-2" }}
                  </h3>
                </div>
              </div>
              <div class="col-6">
                <div class="border-start border-secondary border-4 ps-3">
                  <p class="text-muted mb-1 small">Date</p>
                  <h6 class="mb-0 fw-semibold">
                    {{ stats.latestExpense.date | date : "dd MMM yyyy" }}
                  </h6>
                </div>
              </div>
              <div class="col-12">
                <div class="d-flex align-items-center gap-2 mb-2">
                  <span class="text-muted small">Category:</span>
                  <span class="badge bg-danger px-3 py-2">
                    <i class="bi bi-tag-fill me-1"></i
                    >{{ stats.latestExpense.category }}
                  </span>
                </div>
                <div
                  class="bg-light rounded p-3"
                  *ngIf="stats.latestExpense.description"
                >
                  <small class="text-muted d-block mb-1">Description:</small>
                  <p class="mb-0">{{ stats.latestExpense.description }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Data State -->
    <div *ngIf="!stats" class="row">
      <div class="col-12">
        <div
          class="card border-0 shadow-lg text-center py-5"
          style="background: rgba(255, 255, 255, 0.95)"
        >
          <div class="card-body p-5">
            <div
              class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-4"
              style="width: 120px; height: 120px"
            >
              <i class="bi bi-inbox display-1 text-warning"></i>
            </div>
            <h2 class="fw-bold mb-3">No Data Available</h2>
            <p class="text-muted fs-5 mb-4">
              Start tracking your finances by adding your first income or
              expense
            </p>
            <div class="d-flex gap-3 justify-content-center flex-wrap">
              <a
                routerLink="/incomes"
                class="btn btn-success btn-lg px-4 shadow"
              >
                <i class="bi bi-plus-circle me-2"></i>Add Income
              </a>
              <a
                routerLink="/expenses"
                class="btn btn-danger btn-lg px-4 shadow"
              >
                <i class="bi bi-plus-circle me-2"></i>Add Expense
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dual Chart Section - Modern Design -->
<div class="row g-4">
  
  <!-- Income Chart -->
  <div class="col-lg-6">
    <div class="card border-0 shadow-lg h-100" style="background: rgba(255, 255, 255, 0.95); border-left: 4px solid #10b981 !important;">
      
      <!-- Income Chart Header -->
      <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);">
        <div class="d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-3">
            <div class="bg-white bg-opacity-25 p-2 rounded-3">
              <i class="bi bi-arrow-down-circle-fill text-white fs-4"></i>
            </div>
            <div>
              <h5 class="mb-0 fw-bold text-white">Income Trend</h5>
              <small class="text-white-50">Last 10 months</small>
            </div>
          </div>
          <div class="badge bg-white bg-opacity-25 text-white px-3 py-2">
            ₹{{ stats?.income || 0 | number:'1.0-0' }}
          </div>
        </div>
      </div>

      <!-- Income Stats Bar -->
      <div class="bg-success bg-opacity-10 px-4 py-3 border-bottom">
        <div class="row g-2 text-center">
          <div class="col-4">
            <small class="text-muted d-block">Total</small>
            <strong class="text-success">₹{{ stats?.income || 0 | number:'1.0-0' }}</strong>
          </div>
          <div class="col-4">
            <small class="text-muted d-block">Min</small>
            <strong class="text-success">₹{{ stats?.minIncome || 0 | number:'1.0-0' }}</strong>
          </div>
          <div class="col-4">
            <small class="text-muted d-block">Max</small>
            <strong class="text-success">₹{{ stats?.maxIncome || 0 | number:'1.0-0' }}</strong>
          </div>
        </div>
      </div>

      <!-- Income Chart Body -->
      <div class="card-body p-4">
        <div class="position-relative" style="height: 300px;">
          <canvas id="incomeChart"></canvas>
        </div>
      </div>

      <!-- Income Chart Footer -->
      <div class="card-footer bg-transparent border-top py-2">
        <div class="d-flex justify-content-between align-items-center">
          <small class="text-muted">
            <i class="bi bi-circle-fill text-success" style="font-size: 8px;"></i>
            {{ incomes.length || 0 }} transactions
          </small>
          <small class="text-success">
            <i class="bi bi-arrow-up"></i> Income flow
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Expense Chart -->
  <div class="col-lg-6">
    <div class="card border-0 shadow-lg h-100" style="background: rgba(255, 255, 255, 0.95); border-left: 4px solid #ef4444 !important;">
      
      <!-- Expense Chart Header -->
      <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, #dc2626 0%, #f87171 100%);">
        <div class="d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-3">
            <div class="bg-white bg-opacity-25 p-2 rounded-3">
              <i class="bi bi-arrow-up-circle-fill text-white fs-4"></i>
            </div>
            <div>
              <h5 class="mb-0 fw-bold text-white">Expense Trend</h5>
              <small class="text-white-50">Last 10 months</small>
            </div>
          </div>
          <div class="badge bg-white bg-opacity-25 text-white px-3 py-2">
            ₹{{ stats?.expense || 0 | number:'1.0-0' }}
          </div>
        </div>
      </div>

      <!-- Expense Stats Bar -->
      <div class="bg-danger bg-opacity-10 px-4 py-3 border-bottom">
        <div class="row g-2 text-center">
          <div class="col-4">
            <small class="text-muted d-block">Total</small>
            <strong class="text-danger">₹{{ stats?.expense || 0 | number:'1.0-0' }}</strong>
          </div>
          <div class="col-4">
            <small class="text-muted d-block">Min</small>
            <strong class="text-danger">₹{{ stats?.minExpense || 0 | number:'1.0-0' }}</strong>
          </div>
          <div class="col-4">
            <small class="text-muted d-block">Max</small>
            <strong class="text-danger">₹{{ stats?.maxExpense || 0 | number:'1.0-0' }}</strong>
          </div>
        </div>
      </div>

      <!-- Expense Chart Body -->
      <div class="card-body p-4">
        <div class="position-relative" style="height: 300px;">
          <canvas id="expenseChart"></canvas>
        </div>
      </div>

      <!-- Expense Chart Footer -->
      <div class="card-footer bg-transparent border-top py-2">
        <div class="d-flex justify-content-between align-items-center">
          <small class="text-muted">
            <i class="bi bi-circle-fill text-danger" style="font-size: 8px;"></i>
            {{ expenses.length || 0 }} transactions
          </small>
          <small class="text-danger">
            <i class="bi bi-arrow-down"></i> Expense flow
          </small>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
</div>
