<div class="container-fluid px-4 py-4" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); min-height: 100vh;">
  
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-lg" style="background: rgba(255, 255, 255, 0.95);">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
              <h1 class="display-6 fw-bold mb-2 text-danger">
                <i class="bi bi-arrow-up-circle-fill"></i> Expense Management
              </h1>
              <p class="text-muted mb-0 fs-6">Track and manage your expenses efficiently</p>
            </div>
            <div class="d-flex gap-2 align-items-center">
              <div class="bg-danger bg-opacity-10 px-4 py-3 rounded-3">
                <small class="text-danger text-uppercase fw-semibold d-block mb-1">Total Expenses</small>
                <h3 class="text-danger fw-bold mb-0">₹{{ getTotalExpense() | number:'1.2-2' }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="row mb-4">
    <div class="col-12">
      <div class="alert alert-danger alert-dismissible fade show shadow border-0 d-flex align-items-center" role="alert">
        <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
        <div class="flex-grow-1">
          <strong>Error!</strong> {{ error }}
        </div>
        <button type="button" class="btn-close" (click)="error = null" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Form Section -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-lg sticky-top" style="top: 20px; background: rgba(255, 255, 255, 0.95);">
        <div class="card-header border-0 py-3" 
             style="background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);">
          <h5 class="mb-0 text-white fw-bold d-flex align-items-center gap-2">
            <i class="bi" [ngClass]="isEditMode ? 'bi-pencil-square' : 'bi-plus-circle'"></i>
            {{ isEditMode ? 'Edit' : 'Add New' }} Expense
          </h5>
        </div>
        <div class="card-body p-4">
          <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()">
            
            <!-- Title -->
            <div class="mb-3">
              <label class="form-label fw-semibold text-muted small">
                <i class="bi bi-card-text me-1"></i>Title *
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg border-2" 
                formControlName="title" 
                placeholder="e.g., Groceries, Bills"
                [class.is-invalid]="expenseForm.get('title')?.invalid && expenseForm.get('title')?.touched">
              <div class="invalid-feedback">
                <i class="bi bi-exclamation-circle me-1"></i>Title is required
              </div>
            </div>

            <!-- Amount -->
            <div class="mb-3">
              <label class="form-label fw-semibold text-muted small">
                <i class="bi bi-currency-rupee me-1"></i>Amount *
              </label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-danger bg-opacity-10 border-2 text-danger fw-bold">₹</span>
                <input 
                  type="number" 
                  class="form-control border-2" 
                  formControlName="amount" 
                  placeholder="0.00"
                  [class.is-invalid]="expenseForm.get('amount')?.invalid && expenseForm.get('amount')?.touched">
                <div class="invalid-feedback">
                  Valid amount is required
                </div>
              </div>
            </div>

            <!-- Date -->
            <div class="mb-3">
              <label class="form-label fw-semibold text-muted small">
                <i class="bi bi-calendar-event me-1"></i>Date *
              </label>
              <input 
                type="date" 
                class="form-control form-control-lg border-2" 
                formControlName="date"
                [class.is-invalid]="expenseForm.get('date')?.invalid && expenseForm.get('date')?.touched">
              <div class="invalid-feedback">
                Date is required
              </div>
            </div>

            <!-- Category -->
            <div class="mb-3">
              <label class="form-label fw-semibold text-muted small">
                <i class="bi bi-tag me-1"></i>Category *
              </label>
              <select 
                class="form-select form-select-lg border-2" 
                formControlName="category"
                [class.is-invalid]="expenseForm.get('category')?.invalid && expenseForm.get('category')?.touched">
                <option value="">Select a category</option>
                <option *ngFor="let cat of categories" [value]="cat">
                  {{ cat }}
                </option>
              </select>
              <div class="invalid-feedback">
                Category is required
              </div>
            </div>

            <!-- Description -->
            <div class="mb-4">
              <label class="form-label fw-semibold text-muted small">
                <i class="bi bi-chat-left-text me-1"></i>Description
              </label>
              <textarea 
                class="form-control border-2" 
                formControlName="description" 
                rows="3" 
                placeholder="Add notes or details (optional)"
                style="resize: none;"></textarea>
            </div>

            <!-- Buttons -->
            <div class="d-grid gap-2">
              <button 
                type="submit" 
                class="btn btn-lg btn-danger shadow" 
                [disabled]="expenseForm.invalid || loading">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!loading" class="bi" [ngClass]="isEditMode ? 'bi-check-circle' : 'bi-plus-circle'"></i>
                {{ isEditMode ? 'Update' : 'Add' }} Expense
              </button>
              <button 
                type="button" 
                class="btn btn-lg btn-outline-secondary" 
                *ngIf="isEditMode" 
                (click)="resetForm()">
                <i class="bi bi-x-circle me-1"></i>Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- List Section -->
    <div class="col-lg-8">
      <div class="card border-0 shadow-lg" style="background: rgba(255, 255, 255, 0.95);">
        <div class="card-header border-0 bg-transparent py-3">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <h5 class="mb-0 fw-bold d-flex align-items-center gap-2">
              <i class="bi bi-list-ul text-danger"></i>
              Expense List
              <span class="badge bg-danger rounded-pill">{{ expenses.length }}</span>
            </h5>
            <button class="btn btn-outline-danger btn-sm" (click)="loadExpenses()" [disabled]="loading">
              <i class="bi bi-arrow-clockwise" [class.spinning]="loading"></i>
              Refresh
            </button>
          </div>
        </div>
        
        <div class="card-body p-0">
          <!-- Loading State -->
          <div *ngIf="loading" class="text-center py-5">
            <div class="spinner-border text-danger mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted">Loading expenses...</p>
          </div>

          <!-- Expense Cards for Mobile -->
          <div class="d-lg-none p-3" *ngIf="!loading">
            <div *ngFor="let expense of expenses" class="card mb-3 border-0 shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <h6 class="fw-bold mb-1">{{ expense.title }}</h6>
                    <span class="badge bg-danger">{{ expense.category }}</span>
                  </div>
                  <h5 class="text-danger fw-bold mb-0">₹{{ expense.amount | number:'1.2-2' }}</h5>
                </div>
                <p class="text-muted small mb-2">
                  <i class="bi bi-calendar me-1"></i>{{ expense.date | date:'dd MMM yyyy' }}
                </p>
                <p class="mb-3 small">{{ expense.description || 'No description' }}</p>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-outline-warning flex-grow-1" (click)="editExpense(expense)">
                    <i class="bi bi-pencil"></i> Edit
                  </button>
                  <button class="btn btn-sm btn-outline-danger flex-grow-1" (click)="deleteExpense(expense.id!)">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </div>
              </div>
            </div>
            <div *ngIf="expenses.length === 0" class="text-center py-5">
              <i class="bi bi-inbox display-1 text-muted mb-3 d-block"></i>
              <h5 class="text-muted">No expenses found</h5>
              <p class="text-muted">Add your first expense to get started</p>
            </div>
          </div>

          <!-- Table for Desktop -->
          <div class="table-responsive d-none d-lg-block" *ngIf="!loading">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="fw-semibold text-muted small text-uppercase px-4 py-3">
                    <i class="bi bi-card-text me-2"></i>Title
                  </th>
                  <th class="fw-semibold text-muted small text-uppercase py-3">
                    <i class="bi bi-currency-rupee me-2"></i>Amount
                  </th>
                  <th class="fw-semibold text-muted small text-uppercase py-3">
                    <i class="bi bi-calendar me-2"></i>Date
                  </th>
                  <th class="fw-semibold text-muted small text-uppercase py-3">
                    <i class="bi bi-tag me-2"></i>Category
                  </th>
                  <th class="fw-semibold text-muted small text-uppercase py-3">
                    <i class="bi bi-chat-left-text me-2"></i>Description
                  </th>
                  <th class="fw-semibold text-muted small text-uppercase py-3 text-center">
                    <i class="bi bi-gear me-2"></i>Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let expense of expenses; let i = index" class="border-bottom">
                  <td class="px-4 py-3">
                    <div class="d-flex align-items-center gap-2">
                      <div class="bg-danger bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" 
                           style="width: 40px; height: 40px; min-width: 40px;">
                        <i class="bi bi-receipt text-danger"></i>
                      </div>
                      <span class="fw-semibold">{{ expense.title }}</span>
                    </div>
                  </td>
                  <td class="py-3">
                    <span class="text-danger fw-bold">₹{{ expense.amount | number:'1.2-2' }}</span>
                  </td>
                  <td class="py-3">
                    <span class="text-muted">{{ expense.date | date:'dd MMM yyyy' }}</span>
                  </td>
                  <td class="py-3">
                    <span class="badge bg-danger bg-opacity-10 text-danger px-3 py-2">
                      {{ expense.category }}
                    </span>
                  </td>
                  <td class="py-3">
                    <span class="text-muted" [title]="expense.description">
                      {{ expense.description ? (expense.description.length > 30 ? expense.description.substring(0, 30) + '...' : expense.description) : '-' }}
                    </span>
                  </td>
                  <td class="py-3 text-center">
                    <div class="btn-group" role="group">
                      <button 
                        class="btn btn-sm btn-outline-warning" 
                        (click)="editExpense(expense)"
                        title="Edit">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button 
                        class="btn btn-sm btn-outline-danger" 
                        (click)="deleteExpense(expense.id!)"
                        title="Delete">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="expenses.length === 0">
                  <td colspan="6" class="text-center py-5">
                    <i class="bi bi-inbox display-1 text-muted mb-3 d-block"></i>
                    <h5 class="text-muted mb-2">No expenses found</h5>
                    <p class="text-muted mb-0">Start by adding your first expense</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Card Footer with Stats -->
        <div class="card-footer bg-transparent border-top py-3" *ngIf="expenses.length > 0 && !loading">
          <div class="row g-3 text-center">
            <div class="col-md-4">
              <div class="bg-danger bg-opacity-10 rounded-3 p-3">
                <small class="text-danger text-uppercase fw-semibold d-block mb-1">Total</small>
                <h5 class="text-danger fw-bold mb-0">₹{{ getTotalExpense() | number:'1.2-2' }}</h5>
              </div>
            </div>
            <div class="col-md-4">
              <div class="bg-secondary bg-opacity-10 rounded-3 p-3">
                <small class="text-secondary text-uppercase fw-semibold d-block mb-1">Count</small>
                <h5 class="text-secondary fw-bold mb-0">{{ expenses.length }}</h5>
              </div>
            </div>
            <div class="col-md-4">
              <div class="bg-info bg-opacity-10 rounded-3 p-3">
                <small class="text-info text-uppercase fw-semibold d-block mb-1">Average</small>
                <h5 class="text-info fw-bold mb-0">₹{{ (getTotalExpense() / expenses.length) | number:'1.2-2' }}</h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>